<%- include("headtable") %>

<body>
    <div class="container">
        <h1>Appointment List</h1>
    
        <!-- ปุ่ม Add Appointments -->
        <div class="mb-3">
            <a href="/bookappointmentsAdmin" class="btn btn-success">Add Appointment</a>
        </div>
    
        <div class="table-container">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Appointment ID</th>
                        <th>Customer Name</th>
                        <th>Dentist Name</th>
                        <th>Employee Name</th>
                        <th>Appointment Date</th>
                        <th>Appointment Time</th>
                        <th>Status</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <% data.forEach((item) => { %>
                        <tr>
                            <td><%= item.appointment_id %></td>
                            <td><%= item.customer_name %></td>
                            <td><%= item.dentist_name %></td>
                            <td><%= item.employee_name %></td>
                            <td><%= item.appointment_date %></td>
                            <td><%= item.appointment_time %></td>
                            <td>
                                <select class="form-control status-select" data-id="<%= item.appointment_id %>">
                                    <option value="Scheduled" class="text-primary" <%= item.status === 'Scheduled' ? 'selected' : '' %>>Scheduled</option>
                                    <option value="Completed" class="text-success" <%= item.status === 'Completed' ? 'selected' : '' %>>Completed</option>
                                    <option value="Cancelled" class="text-danger" <%= item.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                                </select>
                            </td>
                            <td><%= item.notes %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        $(document).ready(function () {
            $(".status-select").each(function () {
                updateStatusColor($(this)); // ตั้งค่าสีเริ่มต้น
            });

            $(".status-select").change(function () {
                const appointment_id = $(this).data("id");
                const status = $(this).val();

                $.post("/updateStatusAppointments", { appointment_id, status }, function (response) {
                    alert(response.message);
                }).fail(function () {
                    alert("Error updating status");
                });

                updateStatusColor($(this)); // เปลี่ยนสีเมื่อเปลี่ยนสถานะ
            });

            function updateStatusColor(selectElement) {
                const selectedOption = selectElement.find("option:selected");
                selectElement.removeClass("text-primary text-success text-danger");
                
                if (selectedOption.val() === "Completed") {
                    selectElement.addClass("text-success");
                } else if (selectedOption.val() === "Cancelled") {
                    selectElement.addClass("text-danger");
                } else {
                    selectElement.addClass("text-primary");
                }
            }
        });
    </script>

</body>
</html>
