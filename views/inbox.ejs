<%- include("head", { Title: "Inbox" }) %>
<body>
    <div class="container">
        <h2>üì© ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>
        
        <% if (messages.length === 0) { %>
            <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà</p>
        <% } else { %>
            <ul class="list-group">
                <% messages.forEach(msg => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong><%= msg.message %></strong>
                            <small class="text-muted d-block">üìÖ <%= msg.created_at %></small>
                        </div>
                        <% if (msg.seen === 0) { %>
                            <button class="btn btn-success btn-sm mark-as-read" data-id="<%= msg.id %>">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
                        <% } else { %>
                            <span class="badge bg-secondary">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
                        <% } %>
                    </li>
                <% }); %>
            </ul>
        <% } %>

        <a href="/" class="btn btn-primary mt-3">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    </div>

    <script>
        document.querySelectorAll('.mark-as-read').forEach(button => {
            button.addEventListener('click', function () {
                const notifId = this.getAttribute('data-id');

                fetch('/mark-as-read', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: notifId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.parentElement.innerHTML = '<span class="badge bg-secondary">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>';
                    } else {
                        alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    }
                });
            });
        });
    </script>
</body>
