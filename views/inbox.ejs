<%- include("head", { Title: "Inbox" }) %>

    <body>
        <div class="container">
            <h2>üì© ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>

            <% if (messages.length===0) { %>
                <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                <% } else { %>
                    <ul class="list-group">
                        <% messages.forEach(msg=> { %>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>
                                        <%= msg.message %>
                                    </strong>
                                    <small class="text-muted d-block">üìÖ <%= msg.created_at %></small>
                                </div>
                                <% if (msg.seen===0) { %>
                                    <button class="btn btn-success btn-sm mark-as-read" data-id="<%= msg.id %>" onclick="markAsRead(<%= msg.id %>)">
                                        ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                    </button>
                                    <% } else { %>
                                        <span class="badge bg-secondary">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
                                        <% } %>
                            </li>
                            <% }); %>
                    </ul>
                    <% } %>

                        <a href="/" class="btn btn-primary mt-3">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        </div>

        <script>
            function markAsRead(notificationId) {
                fetch('/mark-as-read', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: notificationId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.querySelector(`[data-id="${notificationId}"]`).parentElement.innerHTML =
                            '<span class="badge bg-secondary">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>';
        
                        if (data.unread === 0) {
                            sessionStorage.setItem("hasNotifications", "false");
                        }
                    } else {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!");
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        </script>
        
        
    </body>